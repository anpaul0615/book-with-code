# 13장 진짜로 만들기


## 메모

> ..이전에는 가짜 구현이 있을 때 진짜 구현으로 거꾸로 작업해 가는 것이 명확했다. 단순히 상수를 변수로 치환하는 일이었다. 그렇지만 이번에는 어떻게 거꾸로 작업해야 할지 분명하지 않다. 그래서 조금 불확실한 감이 있긴 하지만 순방향으로 작업해보자.

> ..위 테스트는 그리 오래가지 못할 것이다. 위 테스트는 외부 행위가 아닌 내부 구현에 대해 너무 깊게 관여하고 있다.

> ..클래스를 명시적으로 검사하는 코드가 있을 때에는 항상 다형성(polymorphism)을 사용하도록 바꾸는 것이 좋다.

> ..Expression 과 Bank 에 이름은 동일하지만 매개 변수 형이 다른 메서드(reduce)가 있다는 것이 만족스럽지는 않다.

> ..위치 매개 변수(positional parameters) 만으로는 두 메서드가 어떻게 다른지에 대해 코드에 명확히 담아내는 것이 쉽지 않다.

> ..예컨대 파이썬 같은 언어에서는 `reduce(exp=myexpression, currency='USD')` 와 `reduce(currency='USD')` 같은 식으로 매개변수의 이름을 명시화해서 의도를 분명히 드러낼 수 있다.

> 모든 중복이 제거되기 전까지는 테스트를 통과한 것으로 치지 않았다.  
> 구현하기 위해 역방향이 아닌 순방향으로 작업했다.  
> 앞으로 필요할 것으로 예상되는 객체(Sum) 의 생성을 강요하기 위한 테스트를 작성했다.  
> 빠른 속도로 구현하기 시작했다. (ex. Sum 의 생성자)  
> 일단 한 곳에 캐스팅을 이용해서 코드를 구현했다가, 테스트가 돌아가자 그 코드를 적당한 자리로 옮겼다.  
> 명시적인 클래스 검사를 제거하기 위해 다형성을 사용했다.  


## 코드 실습

- [Step 34 : 테스트 대상코드 수정 (Sum 클래스 정의)](./section13.step34.test.ts)
- [Step 35 : 새로운 테스트케이스 추가 (Sum 클래스를 통한 더하기 계산)](./section13.step35.test.ts)
- [Step 36 : 테스트 대상코드 수정 (Bank.reduce 구현)](./section13.step36.test.ts)
- [Step 37 : 테스트 대상코드 수정 (Sum.reduce 구현 → 총액 합산에 대한 책임을 Bank.reduce 에서 Sum.reduce 로 이동)](./section13.step37.test.ts)
- [Step 38 : 새로운 테스트케이스 추가 (Bank.reduce 의 인자로 Money 를 넘겼을때)](./section13.step38.test.ts)
- [Step 39 : 테스트 대상코드 수정 (Bank.reduce 내부에서 Money 클래스 검사 구현)](./section13.step39.test.ts)
- [Step 40 : 테스트 대상코드 수정 (Bank.reduce 를 Expression 인터페이스로 끌어올림)](./section13.step40.test.ts)

