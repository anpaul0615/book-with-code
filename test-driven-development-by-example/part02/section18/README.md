# 18장 xUnit으로 가는 첫걸음


## 메모

> ..테스트 툴을 만드는 과정에서 만들어지는 테스트 툴 자체를 사용한다는 것은, 스스로 자신의 뇌를 수술하는 것과 비슷할 것 같다.

> ..테스트 프레임워크의 로직은 1부의 Money 예제보다 더 복잡하기 때문에 2부는 테스트 주도 개발을 통해 "실제" 소프트웨어를 만드는 발전된 예제로 생각할 수 있다. 또 2부를 자기참조(self-referential) 프로그래밍에 대한 전산학 실습으로 생각할 수도 있다.

> ..우선 테스트케이스를 만들고 테스트메서드를 실행할 수 있어야 한다. 예를 들면 `TestCase("testMethod").run()` 정도가 되겠다.

> ..그런데 한가지 부트스트랩의 문제가 있다. 우린 테스트케이스를 작성하기 위해 사용할 프레임워크를 테스트하기 위한 테스트케이스를 작성해야 하는 것이다.

> ..**테스트먼저, 테스트먼저.**

> ..다음으로 필요한 것은 테스트메서드를 직접 호출하는 대신 진짜 인터페이스인 run() 메서드를 사용하는 것이다.

> ..많은 리팩토링에 이런 느낌이 있다. 두 부분을 서로 분리하여 각각에 따로 작업할 수 있다. 작업이 끝날때 두 부분이 원래대로 하나로 돌아간다면 그것도 괜찮다. 만약 그렇지 않으면 두 부분을 분리된 상태로 놔둘 수 있다.

> ..다음 단계는 testMethod() 를 동적으로 호출하는 것이다. 파이썬의 가장 멋진 특징 중 하나는 클래스의 이름이나 메서드의 이름을 함수처럼 다룰 수 있다는 점이다.

> ..여기 또 다른 리팩토링의 일반적인 패턴이 있다. 하나의 특별한 사례에 대해서만 작동하는 코드를 가져다가 다른 여러 사례에 대해서도 작동할 수 있도록 상수를 변수로 일반화하는 것이다.

> ..머릿속 순수한 추론에 의해 일반화하게 하지 않고, 잘 돌아가는 구체적인 사례에서 시작하여 일반화할 수 있게 해 준다는 점에서 TDD 는 이 리팩토링 패턴을 잘 지원한다.

> ..**run() 메서드는 상위클래스에 있는 속성만을 사용하므로 이것도 상위클래스로 올라가는게 맞는것 같다.** (난 항상 오퍼레이션을 데이터 근처에 놓을 방법에 대해 고민한다)

> ..테스트코드의 내용이 단순히 print 문이 아닌 assert 문으로 바뀐 것으로, 우리가 해낸 것이 메서드 추출의 한 복잡한 형태임을 알 수 있었다.

> 꼭 이런 작은 단계로 작업해야 하는 것은 아니다. 일단 TDD 를 마스터하면 훨씬 큰 기능단위로 작업할 수 있게 될 것이다. 하지만 TDD 를 마스터하기 위해서는 **필요할 때 이런 작은 단계로 작업하는 법을 배워야 한다.**

> 자기 과신에 차서 몇 번의 잘못된 출발을 한 후, 아주 자그마한 단계로 시작하는 법을 알아냈다.  
> 일단 하드코딩을 한 다음에 상수를 변수로 대체하여 일반성을 이끌어 내는 방식으로 기능을 구현했다.  
> 플러거블 셀렉터(Pluggable Selector)를 사용했다. 플러거블 셀렉터는 정적 코드 분석을 어렵게 만들기 때문에 앞으로 최소 4개월 안에는 사용하지 않기로 약속하자.  
> 테스트 프레임워크를 작은 단계로만 부트스트랩했다.  


## 코드실습

- [Step01 : 새로운 테스트케이스 추가 (테스트함수를 테스트하는 테스트코드)](./step01.py)  
- [Step02 : 모델코드 수정 (테스트 수행 클래스 정의)](./step02.py)   
- [Step03 : 모델코드 수정 (WasRun.testMethod 정의)](./step03.py)  
- [Step04 : 모델코드 수정 (생성자 정의)](./step04.py)  
- [Step05 : 모델코드 수정 (WasRun.testMethod 구현)](./step05.py)  
- [Step06 : 리팩토링 (WasRun.testMethod 직접호출에서 WasRun.run 을 통한 간접호출로 변경)](./step06.py)  
- [Step07 : 리팩토링 (WasRun.run 을 동적 함수호출로 구현)](./step07.py)  
- [Step08 : 리팩토링 (상위클래스 TestCase 정의)](./step08.py)  
- [Step09 : 리팩토링 (하위클래스 기능을 상위클래스로 이동)](./step09.py)  
- [Step10 : 리팩토링 (테스트 실행코드를 TestCase 를 상속받도록 변경)](./step10.py)  

