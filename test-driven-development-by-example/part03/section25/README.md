# 25장 테스트 주도 개발 패턴
 

## 메모

> ..어떻게 테스트할 것인가에 대하여 자세히 이야기하기 전에 우선 기본적인 전략에 관한 질문에 답해야 한다.  
> 1) 테스트를한다는 것은 무엇을 뜻하는가?  
> 2) 테스트를 언제 해야 하는가?  
> 3) 테스트할 로직을 어떻게 고를 것인가?  
> 4) 테스트할 데이터를 어떻게 고를 것인가?  



### 테스트 (명사)

> ..작성한 소프트웨어를 어떻게 테스트할 것인가?  
> 자동화된 테스트를 만들어라.

> ..당신이 변화를 테스트할 수 있다고 해도, 실제로 변화를 테스트하는 것은 "테스트를 갖고 있다" 는 것과 똑같지 않다.

> ..어쨰서 명사로서의 테스트(자동으로 실행되는 과정) 가 동사로서의 테스트(버튼을 몇 개 눌러보고 화면에 나오는 결과를 주시하는) 와 다른 느낌을 주는 걸까?

> ..**변화를 테스트한다는 것은(수작업) 테스트의 동사적 의미를 암시하고, 테스트를 갖고 있다는 것은(자동화) 테스트의 명사적 의미를 암시한다.** 당신이 변화를 테스트한다고 할지라도, 변화를 테스트하는 것은 테스트를 갖고 있다는것(자동화) 과 똑같지 않다.

> ..이것은 양성피드백고리(positive feedback loop) 이다. 스트레스를 많이 받으면 테스트를 점점 더 뜸하게 한다. 테스트를 뜸하게 하면 당신이 만드는 에러는 점점 더 많아질 것이다. 에러가 많아지면 더 많은 스트레스를 받게 된다.

> ..어떻게 하면 이 고리에서 빠져나올 수 있을까? ..이 경우엔 "테스트" 를 "자동화된 테스트" 로 치환하면 된다.

> ..테스트는 프로그래머를 위한 묘석인데, 두려움을 지루함으로 바꿔주는 효험이 있다. "음, 아무 문제 없군. 테스트가 여전히 초록막대야"

> .."테스트할 시간이 어딨어. 그냥 릴리즈해!" 이 장면에 대해서는 결과를 보장할 수 없다. 스트레스를 점점 많이 받으면 결국 실패하게 된다. 그러나 **자동화된 테스트가 있다면 두려운 정도를 선택할 수 있다.**



### 격리된 테스트

> 테스트를 실행하는 것이 서로 어떤식으로 영향을 미쳐야 좋은가?  
> 아무 영향이 없어야 한다.

> ..각각의 테스트는 다른 테스트와 완전히 독립적이어야 한다는 것이다. 즉 **문제가 하나면 테스트도 하나만 실패해야 하고, 문제가 둘이면 테스트도 두 개만 실패해야 한다.**

> ..격리된 테스트가 암묵적으로 내포하는 특징 중 하나는 테스트가 실행순서에 독립적이게 된다는 점이다. 테스트의 일부만 실행해보고 싶으면, 선행 테스트가 실행되지 않아서 내가 고른 테스트들이 실패하지 않을까 걱정할 필요 없이 그렇게 할 수 있어야 한다.

> ..격리된 테스트가 내포하는 게 또 하나 있는데, 이는 주어진 문제를 작은 단위로 분리하기 위해 노력해서(떄론 매우 많은 노력이 필요하다) 각 테스트를 실행하기 위한 환경을 쉽고 빠르게 세팅할 수 있게 해야 한다는 것이다.

> ..**테스트를 격리하기 위한 작업은 결과적으로 시스템이 응집도는 높고 결합도는 늦은 객체의 모음으로 구성되도록 한다.**



### 테스트 목록

> 뭘 테스트해야하나?  
> 시작하기 전에 작성해야 할 테스트 목록을 모두 적어둘 것.

> ..프로그래밍 스트레스를 줄이기 위한 우리 접근법의 첫 단계는 발 디딜 곳이 확실해지기 전엔 결코 발을 떼어 전진하지 말자는 것이다.

> ..나는 향후 몇 시간 내로 해치워야 하는 모든 할일 목록을 컴퓨터 옆에 있는 종이 조각에 적어놓는 습관을 갖게 됐다. ..**이걸 다 적기만 하면 앞으로는 할일을 놓치지 않게 될 것이다.**

> ..내 경우에 테스트를 한번에 다 만들어 놓는 방법이 먹히지 않았던 두가지 이유가 있다.

> ..첫째, 만들어진 모든 테스트는 리팩토링에 대해 약간의 관성을 갖는다 ..열 개의 테스트를 만든 후에 매개변수의 순서를 반대로 하는게 좋을거라는 사실을 발견하더라도 여러분은 아마 이 순서를 바꾸지 않으려 할 것이다.

> ..둘째, 열 개의 테스트가 실패했다면 초록 막대를 보는것은 한참 멀었다. 빨리 초록 막대를 볼 방법은 열 개의 테스트를 몽땅 지워버리는 것뿐이다.

> ..**테스트를 통과하게 만드는 과정에서 여러분이 작성한 코드들은 새로운 테스트가 필요함을 암시적으로 알려줄 것이다.** 이 새 테스트를 리팩토링과 마찬가지로 할일 목록에 적어 놓아라.

> ..**제대로 작동하지 않는 테스트를 하나라도 생각할 수 있다면, 그걸 제대로 되게 하는 것이 코드를 릴리즈하는 것보다 더 중요하다.**



### 테스트 우선

> 테스트를 언제 작성하는 것이 좋을까?  
> 테스트 대상이 되는 코드를 작성하기 직전에 작성하는 것이 좋다.

> ..위 쪽에 있는 스트레스는 아래쪽에 있는 테스트와 음성적으로 연결되어 있다. 스트레스를 받을수록 테스트가 충분치 못할 가능성이 높아진다. 테스트를 충분히 하지 못했다고 생각하면 스트레스는 더 커진다.

> ..테스트를 먼저 해야 한다는 규칙을 도입해보면 어떨까? 그렇게하면 영향도를 뒤집을 수 있고 효과적인 주기를 만들어내개 된다.위쪽에 있는 "테스트 먼저" 가 아래쪽에 있는 "스트레스" 에 음성적으로 연결된다. **테스트를 먼저 하면 스트레스가 줄고, 따라서 테스트를 더 많이 하게 된다.**



### 단언 우선

> 테스트를 작성할 떄, 단언(assert) 은 언제쯤 쓸까?  
> 단언을 제일 먼저 쓰고 시작하라.

> 시스템을 개발할때 무슨 일부터 하는가?  
> 완료된 시스템이 어떨거라고 알려주는 이야기부터 작성한다.

> 특정 기능을 개발할 때 무슨 일부터 하는가?  
> 기능이 완료되면 통과할 수 있는 테스트부터 작성한다.

> 테스트를 개발할 떄 무슨 일부터 하는가?  
> **완료될 때 통과해야 할 단언부터 작성한다.**

> ..단언을 먼저 작성하면 작업을 단순하게 만드는 강력한 효과를 볼 수 있다. 구현에 대해 전혀 고려하지 않고 테스트만 작성할 때도 사실 여러분은 몇 가지 문제들을 한번에 해결하는 것이다.

> 테스트하고자 하는 기능이 어디에 속하는 걸까? 기존의 메서드를 수정해야하나, 기존의 클래스에 새로운 메서드를 추가해야 하나, 아니면 이름이 같은 메서드를 새 장소에? 또는 새 클래스에?    
> 메서드의 이름은 뭐라고 해야하나?  
> 올바른 결과를 어떤식으로 검사할 것인가?  
> 이 테스트가 제안하는 또 다른 테스트에는 뭐가 있을까?  



### 테스트 데이터

> 테스트할 떄 어떤 데이터를 사용해야 하는가?  
> 테스트를 읽을 떄 쉽고 따라가기 좋을 만한 데이터를 사용하라.

> ..테스트 작성에도 청중이 존재한다. 단지 데이터 값을 산발하기 위해 데이터 값을 산발하지 마라. **데이터 간에 차이가 있다면 그 속에 어떤 의미가 있어야 한다.** 1 과 2 사이에 어떠한 개념적 차이도 없다면 1 을 사용하라.

> ..테스트 데이터 패턴의 한 가지 트릭은 여러 의미를 담는 동일한 상수를 쓰지 않는 것이다. ..만약 구현에서 인자의 순서가 뒤집힌다면 어떻게 될까? ..우리가 첫 번쨰 인자로 2 를 썼다면 두 번째 인자는 3 을 써야 한다.



### 명백한 데이터

> 데이터의 의도를 어떻게 표현할 것인가?  
> 테스트 자체에 예상되는 값과 실제 값을 포함하고 이 둘 사이의 관계를 드러내기 위해 노력하라.

> ..**테스트를 작성할 때는 컴퓨터뿐 아니라 후에 코드를 읽을 다른 사람들도 생각해야 한다.**

> ..이 테스트에서는 입력으로 사용된 숫자와 예상되는 결과 사이의 관계를 읽어낼 수가 있다.

> ..명백한 데이터가 주는 또 다른 이점은 프로그래밍이 더 쉬워진다는 것이다. 단언 부분에 일단 수식을 써놓으면 다음으로 무엇을 해야할지 쉽게 알게 된다.

> ..명백한 데이터는 코드에 매직넘버를 쓰지 말라는 것에 대한 예외적인 규칙일 수 있다.


